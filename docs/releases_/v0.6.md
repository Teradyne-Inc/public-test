# v0.6 - 2025-07-01

## Breaking Changes 

### Adding the optional parameter `gate` to the setup functions.

**Changes to the functions in the following way:**

- The `connect` method will retain the option for `gate`, but it will be set to false by default instead of having `gate on` as the default.

- The `Force`, `ForceI`, `ForceV` and `SetForceAndMeter` methods will include an optional parameter to enable `gate`, which will, by default, switch to `gate on`.

- The `disconnect` method will keep the `gate` option and default to `gate off`.

_The reasoning behind this is that it's safer to enable `gate` after the instrument is configured. In the current test methods, we enable `gate` in the `connect` method, but this approach involves connecting and powering the source with inherited settings, without knowing whether those settings are safe for the DUT._

### Custom Action Use-Model Changed

Instead of having one use-model for custom settings, three different are introduced to target specific use-cases. 

```c#
// previous use-model
Setting.Custom<T>(string key, T value, Action<T> setAction, Func<T[]> readFunc, T initValue, InitMode initMode, double settlingTime);

// new use-model
Setting.Custom<T>(T value, Action<T> setAction); // always executes
Setting.Custom<T>(string key, T value, Action<T> setAction, T initValue, InitMode initMode); // executes depending on cache
Setting.Custom<T>(string key, T value, Action<T> setAction, Func<T[]> readFunc, T initValue, InitMode initMode); // has also read capabilities
```

**Impact:** Users who have used the `Custom` Setting need to change their code to one of these three use-models.

### Update & Enhance Test Blocks for LinearFull, LinearStop & Binary Search

Functionality has been added to support searching for "closest-to-target" and overloads returning the search indices & output values for the input found. The method's signatures have been updated for consistency.

**Impact:** Little impact as not widely (at all?) used so far.

##  Bug Fixes 

### Fixing the bug for measure current in MultiCondition

`Voltage` measurement was always selected.

### Fixing the bug in MultiCondition

The issue regarding the for loop condition has been resolved, it now references the measured values. For displaying the forced value, a check was introduced to fix the bug when using uniform MultiCondition.

### Solve the bug in Modify for PPMU

The syntax in method Modify for PPMU had an issue related to settings - if Mode and MeterMode were not set, an error was returned. This update ensures that the error is only triggered in specific cases where the required parameters are not provided.

### Changes to the Force method

The issues that occurred for DCVS and DCVI are due to the `clampValue`. If the value does not belong to the range of clamp settings, errors will occur. 
Therefore, the call has been adjusted within the Force method so that the clamp value is passed as a range also.

**Impact:** On the user side, nothing changes.

### Object initialization in IsValidating

Objects are not updated after validation if the user modifies the object (eg, pins) in the instance.

```c#
// Old 
if (TheExec.Flow.IsValidating) {
    _pins ??= new Pins(pinList);
}
 // New 
if (TheExec.Flow.IsValidating) {
    _pins = new Pins(pinList);
}
```

### Modification of the clamp setting for PPMU

The application of the clamp value in the case of PPMU was carried out in accordance with the forced current value when using method SetForceAndMeter.

## Improvements

### Add `Domain` to `Pins` type

Besides `Type` and `Feature`, a `Pins` object can now be queried for `Domain` information, like `Dc`, `Digital` or `Utility`.

```c#
Pins pins = new Pins("ana1, ana2, dig1");
if (!pins.ContainsDomain(InstrumentDomain.Dc)) {
    Console.WriteLine("no DC capable pins");
}
```

**Impact:** Simplifies test block and validation code to check if compatible pins have been provided.

### Disconnecting/Connecting digital pins in TestMethods

Disconnecting/Connecting digital pins in TestMethods before connecting/disconnecting the DC part. 
Modifying the documentation in accordance with TestMethods execution.

### Pattern type as input variable

`Csra.Parametric.MultiCondition.PreconditionPattern` used a `string` instead of a `Pattern`  type as an input variable.


### Value-Based Comparison for `Pin` and `Pins` object

Two `Pin` objects are considered equal if their `Name` properties are equal.
Two `Pins` collections are considered equal if they contain the same sequence of `Pin` objects (by name), in the same order.
