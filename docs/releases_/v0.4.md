# v0.4 - 2025-05-09

## Breaking Changes

### Class Renaming
The class `SetupX` has been renamed to `Setup`.

```c#
// Old class reference
SetupX setup = new SetupX("xx");

// New class reference
Setup setup = new Setup("xx");
```

**Impact:** Users need to update their code to reference the new class name `Setup` instead of `SetupX`.

### Class Renaming
The class `StpHdw` has been renamed to `Setting.TheHdw`.

```c# 
// Old class reference
SetupX normal = new("Normal");
normal.Add(new StpHdw.Utility.Pins.State(tlUtilBitState.Off, ["K2", "K3", "K5", "K6"]));

// New class reference
Setup normal = new("Normal");
normal.Add(new Setting.TheHdw.Utility.Pins.State(tlUtilBitState.Off, ["K2", "K3", "K5", "K6"]));
```

**Impact:** Users need to update their code to reference the new class name `Setting.TheHdw` instead of `StpHdw`.

### Enum Renaming
The enums `Feature` and `Type` of the Pins object has been moved outside of the Pins object and renamed to `InstrumentFeature` and `InstrumentType`.

```c#
// Old enum reference
var feature = Pins.Feature.Ppmu;
var type = Pins.Type.UVS256;

// New enum reference
var feature = InstrumentFeature.Ppmu;
var type = InstrumentType.UVS256;
```

**Impact:** Users need to update their code to reference the new enum names `InstrumentFeature` and `InstrumentType` instead of `Feature` and `Type`.

### Method Renaming
Services that previously had a `Clear` method have renamed it to `Reset`.
Services that did not have a `Clear` method now have a `Reset` method.
The `Reset` method will reset all states of the services.

```c#
// Old method reference
service.Clear();

// New method reference
service.Reset();
```

**Impact:** Users need to update their code to use the `Reset` method for all services.

### Method Renaming
The method `ApplyLevelsTiming` has been split into two methods named `LevelsAndTiming.Apply` and `LevelsAndTiming.ApplyWithPinStates`.

```c#
// Old method reference
TheLib.ApplyLevelsTiming(xxx);

// New method reference
TheLib.LevelsAndTiming.ApplyWithPinStates(xxx);
TheLib.LevelsAndTiming.Apply(xxx);
```

**Impact:** Users need to update their code to reference the new method name `ApplyWithPinStates` or `Apply` instead of `ApplyLevelsTiming`.

### Namespace Renaming
The namespace `ReferenceArchitecture` has been renamed to `Csra`.

```c#
// Old namespace reference
using static ReferenceArchitecture.V1.Api;

// New namespace reference
using static Csra.V1.Api;
```

**Impact:** Users need to update their code to reference the new namespace `Csra` instead of `ReferenceArchitecture`. The IG-XL instance sheet needs to be updated as well to use `Csra`.

### Parameter Update
The method `Connect` now has a parameter `gateOn` with a default value of `true` and `Disconnect` has a parameter `gateOff` with a default value of `true` instead of a nullable parameter.

```c#
// Old method signatures
TheLib.Setup.Dc.Connect(Pins pins, bool? gateOn = null);
TheLib.Setup.Dc.Disconnect(Pins pins, Boolean? gateOn = null);

// New method signatures with default parameter value
TheLib.Setup.Dc.Connect(Pins pins, bool gateOn = true);
TheLib.Setup.Dc.Disconnect(Pins pins, bool gateOff = true);
```

**Impact:** Users need to update their code to handle the `gateOff` and `gateOn` parameter as a non-nullable boolean, which defaults to true.

### Project Renaming
The C# project has been renamed from ADU to Demo.

```c#
// Old project reference
using ADU;

// New project reference
using Demo;
```

**Impact:** Users need to update their project references and namespaces from ADU to Demo to ensure compatibility with the new project structure.

## Bug Fixes

### DCVI Instrument Voltage Clamp Setting
Fixed an issue where the clamp setting for a DCVI instrument was missing. The fix ensures that the clamp setting is now correctly applied.

**Impact:** Users can now correctly set the clamp for the instrument, ensuring proper functionality and preventing potential errors.

### DCVS Instrument Sink Limit restrictions
Fixed an issue where it was possible to set the DCVS instrument outside of its sink limits. The fix ensures that values are now clamped at the maximum limits.

**Impact:** Users can no longer set the DCVS instrument to values outside of its defined limits, ensuring proper functionality and preventing potential errors.

### Initialization Timing in DriverMode
Fixed an issue where the value in the setting `Setting.TheHdw.Digital.Pins.Levels.DriverMode` was incorrectly initialized at `Creation` time instead of during a `OnProgramStarted` event. This change ensures the value now accurately reflects the hardware behavior.

**Impact:** Users do not need to take any action. The fix ensures the value initialization now correctly aligns with the hardware behavior, eliminating potential timing issues.

### ReferenceArchitecture Properties
Fixed an issue where the ReferenceArchitecture has copied the IG-XL dll locally instead of using the IGXLROOT environment variable, as Teradyne suggests.

**Impact:** Users do not need to set the property manually to false.

## Improvements

### Default Value Change
The default value of the `RespectSettlingTimeDefault` property of the `SetupService` has been change from `true` to `false`. This change eliminates potential wait time between calls, reducing timing issues.

**Impact:** Users need to be aware of the change in default behavior, which now avoids potential timing issues by not adding wait time between calls.

### Method Addition
A new method `SetForceAndMeter` has been added to consolidate the functionality of `SetForce` and `SetMeter`.

```c# 
// Old method calls
TheLib.Setup.Dc.ForceI(Pins pins, double forceCurrent, double? clampVoltage = null);
// or 
TheLib.Setup.Dc.ForceV(Pins pins, double forceVoltage, double? clampCurrent = null);
TheLib.Setup.Dc.SetMeter(Pins pins, Measure meterMode, double rangeValue, double? filterValue = null, int? hardwareAverage = null, double? outputRangeValue = null);

// New method call
TheLib.Setup.Dc.SetForceAndMeter(Pins pins, TLibOutputMode mode, double forceValue, double forceRange, double clampValue, Measure meterMode, double measureRange);
```

**Impact:** Users can now use the `SetForceAndMeter` method for convenience, while the existing `SetForce` and `SetMeter` methods remain available.

### Mock Injection Support
Added functionality to enable mock injection, allowing users to write unit tests for their code using C#RA. This feature supports mocking `TheLib`, `AlertService`, `SetupService`, `StorageService`.

```c#
// bla
SetupCsraMoq(ILib lib = null, IAlertService alert = null, IStorageService storage = null, ISetupService setup = null)

// Example of mock injection
var mockTheLib = new Mock<ITheLib>();
SetupCsraMoq(mockTheLib.Object);

TheLib.Setup.Dc.Connect(pins, true);
mockTheLib.Verify(lib => lib.Setup.Dc.Connect(pins,true), Times.Once);
```

**Impact:** Users can now easily create mock objects for unit testing, enhancing their ability to write comprehensive unit tests and improving test coverage and reliability of their code.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.ComplianceRange_Negative` and `TheHdw.Dcvi.Pins.ComplianceRange_Positive` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.ComplianceRange_Negative(-2, ["pinName"]));
example.Add(new Setting.TheHdw.Dcvi.Pins.ComplianceRange_Positive(1, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvs.Pins.BleederResistor` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvs.Pins.BleederResistor(tlDCVSOnOffAuto.On, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.DriverMode` settings that can be used to configure the device.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.DriverMode(tlDriverMode.HiZ, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Ioh` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Ioh(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Iol` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Iol(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vch` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vch(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vcl` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vcl(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vih` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vih(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vil` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vil(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Voh` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Voh(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vol` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vol(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Digital.Pins.Levels.Value_Vt` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Digital.Pins.Levels.Value_Vt(0.3, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### SetupService Customer Setting
The `SetupService` now supports customers in setting up their own settings.

**Impact:** Users can now customize their settings using the `SetupService`, providing greater flexibility and control.

### String Handling
The apply-method of the SetupService now supports a comma-separated list as a string, in addition to a normal string.

```c#
// Old method calls
SetupService.Apply("setup1");
SetupService.Apply("setup2");

// New method call
SetupService.Apply("setup1, setup2"); // valid
```

**Impacts:** Users can now pass a comma-separated list to the method, allowing for more flexible data handling.
