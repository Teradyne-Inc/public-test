# v0.5 - 2025-06-02

## Breaking Changes 

### Update outputMode for ForceV and ForceI methods

For the ForceV and ForceI methods, outputMode has been modified to use the Bool type instead of TLibOutputMode.

Explanation: Allowing settings such as "ForceCurrent" or "HighImpedance" in ForceV calls does not make sense. Now, switching to ForceVoltage is permitted, or the output mode change can be omitted if it was previously set, adjusting only the voltage. A similar behavior occurs in the ForceI method.

### Enums Moving
The enums `Kelvin`, `Measure`, `TLibOutputMode` has been moved from `Csra` to `Csra.V1` namespace.

```c# 
// Old namespace reference
using Csra;

// New namespace reference
using Csra.V1;
```

**Impact:** Users need to update their code to reference the namespace `Csra.V1` instead of `Csra` when using those enums.

### Interface Moving
The interface `ISetting` has been moved from `Csra` to `Csra.V1` namespace.

```c# 
// Old namespace reference
using Csra;

// New namespace reference
using Csra.V1;
```

**Impact:** Users need to update their code to reference the namespace `Csra.V1` instead of `Csra` when using the `ISetting` interface.

### Support Pingroups
The `SetupService` now supports pingroups.

```c#
// Example of usage
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.FoldCurrentLimit.Behavior(tlDCVIFoldCurrentLimitBehavior.GateOff, "pinName"));

Setting.TheHdw.Dcvi.Pins.FoldCurrentLimit.Behavior.SetCache(tlDCVIFoldCurrentLimitBehavior.GateOff, "pinName");
```

**Impact:** The syntax for instantiating new settings has slightly changed. Instead of a 'List<string>' of pins, now a single string as comma separated list is used. The string can contain single pins as well as pingroups. This syntax change also affects the 'SetCache()' method of each setting.

## Bug Fixes 

### Adding Forced Value to Datalog

Parametric datalog did not show ForeValue - fixed.

### Bug fix for current range application

The current value setting for DCVS depends on the current range value, which was omitted when using the Force method. In the ForceV and ForceI methods, it is included as an optional parameter. 
However, through the Force method, it cannot set the range value. Modifications have been made so that the range value is always applied without altering the method structure or its call.

### Checking if PinList is null or empty in SingleCondition and MultiCondition.

The condition has been modified to check whether PinList  is empty or null in these blocks.

### Fixing the duplicate ForceVoltage error and missing ForceHiZ in switch

An error was identified in the switch logic used to separate ForceVoltage, ForceCurrent, and ForceHiZ, where ForceHiZ was not correctly included, and ForceVoltage appeared twice. The modification resolves this issue by correcting the switch branching, ensuring the proper distribution of values.

### Remove `StartState` Assignments in `.LevelsAndTiming.ApplyWithPinStates` 

Assignments to `StartState` have been removed for all pin groups (`initPinsHi`, `initPinsLo`, and `initPinsHiZ`). The method now only sets the `InitState`, aligning with the intended behavior described in the documentation.

### Setup.LevelsAndTiming.ApplyWithPinStates now programs inits states before ramping levels up or down

**Impact:** 
ApplyRepeatableSequences uses the init states to determine if levels are powered up or down
ApplyWithPinStates() now prorams the init states before the levels are being ramped up or down. 
This change will only be visible for the parameter "levelRampSequence = True"

## Improvements

### Add TestBlocks for Search

Generic test blocks to allow building test methods for search & trim, using linear full, linear stop or binary search algorithms.

```c#
if (ShouldRunBody) {
    TheLib.Setup.Dc.ForceV(_inputPins, voltageFrom);
    TheLib.Setup.Dc.ForceHiZ(_outputPins);
    double increment = TheLib.Acquire.Search.LinearFullFromToSteps<double>(voltageFrom, voltageTo, stepCount, ForceAndRead);
    _tripVoltage = TheLib.Execute.Search.LinearFullProcess(measurements, voltageFrom, increment, 0, -999, m => m > outputThreshold);
} 

void ForceAndRead(double inValue) {
    TheLib.Setup.Dc.ForceV(_inputPins, inValue);
    TheHdw.SettleWait(stepSettleTime);
    measurements.Add(TheLib.Acquire.Dc.Measure(_outputPins));
}
```

**Impact:** New functionality for integrated and performance optimized search and trim tests.

### Implementation of the 'Modify()' test block

A new test block **TheLib.Setup.DC.Modify()** has been implemented, allowing the incremental modification of DC instrument properties. 

```c#

    private DcParameters _modifySettings;

    [TestMethod, Steppable, CustomValidation]
    public void Baseline(PinList pinList,..., double clampHi, double clampLo, double bandwidthSetting) {

        if (TheExec.Flow.IsValidating) {
            _modifySettings = new DcParameters() {
                ClampHiV = clampHi,
                ClampLoV = clampLo,
                BandwidthSet = bandwidthSetting
            };
        }

        if (ShouldRunBody) {
            TheLib.Setup.Dc.Modify(_pins, _modifySettings);
        }
    }
```

**Impact:** The user has the ability to modify a series of properties in accordance with the necessary settings in the test block.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.BleederResistor.CurrentLoad` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.BleederResistor.CurrentLoad(0.01, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.BleederResistor.Mode` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.BleederResistor.Mode(tlDCVIBleederResistor.Auto, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.FoldCurrentLimit.Behavior` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.FoldCurrentLimit.Behavior(tlDCVIFoldCurrentLimitBehavior.GateOff, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.FoldCurrentLimit.Timeout` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.FoldCurrentLimit.Timeout(0.2, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvi.Pins.NominalBandwidth` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvi.Pins.NominalBandwidth(10, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvs.Pins.CurrentLimit.Sink.FoldLimit.Level` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvs.Pins.CurrentLimit.Sink.FoldLimit.Level(0.01, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvs.Pins.CurrentLimit.Sink.OverloadLimit.Level` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvs.Pins.CurrentLimit.Sink.OverloadLimit.Level(0.01, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.Dcvs.Pins.CurrentLimit.Source.OverloadLimit.Level` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.Dcvs.Pins.CurrentLimit.Source.OverloadLimit.Level(0.01, ["pinName"]));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.SetSettlingTimer` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.SetSettlingTimer(0.1));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### New Setting Support
The `SetupService` now supports `TheHdw.SettleWait` settings that can be used to configure the instruments.

```c#
// Example of using the new setting
Setup example = new("Normal");
example.Add(new Setting.TheHdw.SettleWait(0.1));
SetupService.Add(example);
SetupService.Apply("Normal");
```

**Impact:** Users can now utilize the new setting to customize the `SetupService` according to their needs.

### TestMethod Added

`Linear` and `LinearFull` TestMethod has been added.

Impact: Users can now use the Search.Linear or Search.LinearFull at the TestInstance sheet.
