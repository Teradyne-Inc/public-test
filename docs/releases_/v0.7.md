# v0.7 - 2025-08-01

## Breaking Changes

### BinarySearch test blocks changed, now dedicated implementations for `double` and `int`.

Different strategies mandated going away from generic implementations and making them type specific again. Now, there's an option for floating point and fixed point each. The floating point is implemented for `double`, correctly handles corner cases and is optimized for performance and memory footprint. The fixed point option uses `int` and correctly handles scaling the search intervals towards the (fixed point) resolution.

**Impact:** Users may review and update their implementations.

### Remove RespectSettlingTime Argument

RespectSettlingTime parameter of all features was removed, as instruments already do a settlewait after applying settings. Users may need to adjust their code to get it working again.

```c#
// Old
dcvisetup.Add(new Setting.TheHdw.Dcvi.Pins.ComplianceRange_Positive(0.01, "dcvi1, dcvi2", true));
// New
dcvisetup.Add(new Setting.TheHdw.Dcvi.Pins.ComplianceRange_Positive(0.01, "dcvi1, dcvi2"));
```

This change may improve testtime.

### Support Update: IG-XL Version

Support for **IG-XL CI3 Kits (11.00)** has been discontinued.
**IG-XL Kit 11.00 Alpha 4** is now the officially supported release. This version introduces a more stable foundation for ongoing development and testing.

### Refactor PatternInfo-object

`Name` property is now readonly. Change setter of `ThreadingEnabled` from private to public.

### Rename Instrument Type

Renamed UP5000 -> UPHP.

**Impact:** Potential renaming necessary.

### Substitute `GetDelegate` TestBlock with `MethodHandle` Type

```c#
// previously
TheLib.Validation.GetDelegate<T>("methodName");

// now
new MethodHandle<T>("fullyQualifiedName");
```

**Impact:** Substitute every use of `GetDelegate` with `MethodHandle`.

## Bug Fixes 

### Fixing the bug in SetForceAndMeter

When calling `SetForceAndMeter` with the `Measure.Voltage` measurement configuration, the user will enter a voltage value for the `measureRange` variable. 
In the `ppmu.ForceVMeasureV()` configuration for PPMU, `measureRange` was previously used as the input, however, the method requires `MeasureCurrentRange`. Therefore, in this case, the setting was updated to use `ppmu.MeasureCurrentRange.Max`

The configuration for `MeasureCurrentRange` is still available through method `Modify()`.

### Implementation changes for PPMU in Modify

The current changes allow parameters such as `voltage` or `current` to be set for PPMU without requiring the value for `mode` or `meterMode`. 

The user is not affected by these changes, the function call remains the same.

### Remove workaround for IG-XL bug

SetupService setups can now be created/added in `OnProgramValidated` if IG-XL version is 11.

Usage with IG-XL 10.60.01:
```c#
        [TestMethod]
        public void SetupLoad() {
   
            SetupService.Reset();

            Setup initLeakage = new Setup("InitLeakageTest");
            initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Hi, "nLEAB, nOEAB"));
            initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Lo, "nLEBA, nOEBA"));
            initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Off, "porta"));
            SetupService.Add(initLeakage);
        }
```

Usage with IG-XL 11.00.00:
```c#
        [ExecInterpose_OnProgramValidated(255)]
        public static void OnProgramValidated() {
           Setup initLeakage = new Setup("InitLeakageTest");
           initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Hi, new List<string> { "nLEAB","nOEAB" }));
           initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Lo, new List<string> { "nLEBA","nOEBA" }));
           initLeakage.Add(new Setting.TheHdw.Digital.Pins.InitState(ChInitState.Off, new List<string> { "porta" }));
           SetupService.Add(initLeakage);
        }
```
**Impact:** Move SetupService setup from flow to validation.

## Improvements

### Add offline passing mode to `TestParametric` blocks

Parametric tests can now be forced to pass offline, by datalogging values mid-way between the specified test limits. Any measurements or calculation results fed in are (offline only!) ignored and substituted with values that will never fail. A `BehaviorService` feature has been added to allowing opt-in to this new mode.

```c#
BehaviorService.SetFeature("Datalog.Parametric.OfflinePassResults", true);
TheLib.Datalog.TestParametric(result, 3 * V, "V");
```

**Impact:** Users can opt-in to this new use model, allowing flow path mechanics that are closer to reality.

### 1. Add 6 digital trim tests:

 - `Trim.Digital.LinearStopTrip`: Use linear stop search with trip criteria to find where the test pattern result change from fail to pass.
 - `Trim.Digital.LinearStopTarget`: Use linear stop search with target value to find which test step's output is closest to the target by capturing HRAM data.
 - `Trim.Digital.LinearFullTrip`: Use linear full search with trip criteria to find where the test pattern result change from fail to pass.
 - `Trim.Digital.LinearFullTarget`: Use linear full search with target value to find which test step's output is closest to the target by capturing HRAM data.
 - `Trim.Digital.BinaryTrip`: Use binary search with trip criteria to find where the test pattern result change from  fail to pass.
 - `Trim.Digital.BinaryTarget`: Use binary search with target value to find which test step's output is closest to the target by capturing HRAM data.

### 2. Modify `LinearStopFromToCount`: 

Change `LinearStopFromToCount` to compatible with `Site<int>` when using the `target` parameter.

**Impact:** No impact.

### Add `BehaviorService`

BehaviorService manages configurable, program-wide behavior settings - allowing test programs to adapt to different user preferences or operational modes without modifying source code.

```c#
BehaviorService.SetFeature("MaxRetries", 5);
BehaviorService.SetFeature("Timeout", 30.0);
BehaviorService.SetFeature("EnableLogging", true);
BehaviorService.SetFeature("ApiEndpoint", "https://api.example.com");
```

**Impact:** Users benefit from a single, standardized way to address a common need, that is typically solved by a variety of  incompatible strategies scattered throughout the test program.

### Add `Pins.ArrangePinSite<T>()`

Combines multiple `PinSite<T>` instances into a single `PinSite<T>` by following this `Pins` object's sequence. Excessive objects are quietly ignored, missing ones result in a runtime exception.

```c#
PinSite<int> one = new PinSite<int>(["dig, dcvi"]);
PinSite<int> two = new PinSite<int>(["dcvs1, dcvs2"]);
Pins pins = new("dig, dcvs1, dcvi, dcvs2");

PinSite<int> arranged = pins.ArrangePinSite([one, two]);
```

**Impact:** Removes the limitation where measurement & readback test blocks were limited to a single instrument type only.

### Add BinarySearch test blocks for integer DUT inputs

Binary searches for floating point and integer inputs require slightly different treatment to avoid rounding issues and corner cases. This task adds `int` type searches to the existing ones for `double`, following the exact same use model and method signature.

```c#
Site<int> result = TheLib.Acquire.Search.BinarySearch(0, 100, inMinDelta, false, NonInverting, v => v >= outTarget, -9999, out var outResult);
```

**Impact:** Users now have tailored and optimized binary search algorithms for `int` and `double` inputs.

### Add C#RA version readout API

Users can now read the C#RA version via language in code.

```c#
Console.WriteLine(Csra.Info.Version);
```

**Impact:** Improved maintability and version tracking capability.

### Add conditional PortBridge initialization to Demo program

**Impact:** Users can optionally run the Demo program in a scenario with or without PortBridge.

### Add PortBridge library integration

PortBridge comes as a separate product that can optionally be used in IG-XL based test programs. C#RA supports scenarios with or without this library. In this first step the mechanics of a conditional reference is added, along with a compiler directive to mask calls so that they don't prevent builds when the library isn't available.

```c#
#if PORTBRIDGE_ENABLED
    /// do fancy PortBridge stuff
#endif
```

**Impact:** C#RA authors and users get conditional access to PortBridge language features.

### Change `steps` notation to `count` in LinearSearch test blocks

The term `steps` is indicative for intervals, whereas the way it's used in the linear search test blocks it's being used for the number of overall measurements taken (count). The name change intends to remove ambiguity users have reported - note that no functional change applies. Also see https://en.wikipedia.org/wiki/Off-by-one_error

```c#
LinearFullFromToCount<Tin>(Tin inFrom, Tin inTo, int inCount, Action<Tin> oneMeasurement)
```

**Impact:** Improved clarity for users when requesting step counts in linear search test blocks.

### Change the input parameter of the `Frequency.Timing()` test method

Adjust the input parameters of the `Frequency.Timing()` test method to align it with other test methods, and allow IG-XL to verify if the specified pattern exists.

```c#
//Old 
public void Baseline(string pattern, string measurePins, double waitTime = 0, double measureWindow = 10 * ms, string config = "") 
//New 
public void Baseline(Pattern pattern, PinList pinList, double waitTime = 0, double measureWindow = 10 * ms, string setup = "") 
```
**Impact:** The test program verifies during validation whether the specified pattern exists.

### Extend TestMethod Argument List

Adding `source` and `slope` parameters to the `Timing.Frequency.Baseline` TestMethod.
Removing the default values from the `FrequencyCounter` Setup TestBlock.

**Impact:** User can specify the `source` and `slope` for the frequency read in the TestMethod params instead of in the TestBlock.

### Implement Parametric Search
  
The following search methods have been implemented: 

- `LinearFull` (_The measurements across the entire range are traversed without being evaluated during the linear search, after which the device input condition for which the output pin exceeds the threshold value is provided._); 
- `LinearStop` (_The measurements across the range are traversed with an evaluation performed at each iteration, and the search is stopped once the objective has been reached (on all sites). The device input condition for which the output pin exceeds the threshold value is then provided._);

### Implement Setup.Digital.ModifyXXX blocks

The following ModifyXXX methods have been implemented:

- `ModifyPins`: Selectively program or modify any digital instrument Pins parameter.
- `ModifyPinsLevels`: Selectively program or modify any digital instrument pins levels parameter.
- `ModifyPinsTiming`: Selectively program or modify any digital instrument pins timing parameter.

### Rework PinSiteAddRange

Adding the capability to read more than one instrument in the methods implemented in **Acquire.Dc**, once the `.AddRange()` (from IG-XL 11) becomes available.
